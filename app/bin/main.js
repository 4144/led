// Generated by Haxe 4.1.3
(function ($global) { "use strict";
var ElectronMain = function() { };
ElectronMain.main = function() {
	var hasDownloadedUpdate = false;
	var isInstallingUpdate = false;
	electron_main_App.on("window-all-closed",function() {
		electron_main_App.quit();
	});
	var mainWindow = null;
	electron_main_App.on("ready",function() {
		mainWindow = new electron_main_BrowserWindow({ webPreferences : { nodeIntegration : true}, fullscreenable : true, autoHideMenuBar : true, show : false, title : "L-Ed"});
		mainWindow.loadURL("file://" + __dirname + "/app.html");
		mainWindow.on("closed",function() {
			mainWindow = null;
		});
		mainWindow.maximize();
		mainWindow.on("close",function(ev) {
			if(!isInstallingUpdate) {
				ev.preventDefault();
				mainWindow.webContents.send("winClose");
			}
		});
	});
	electron_main_IpcMain.handle("loadFile",function(event,options) {
		console.log(options);
		var filePaths = electron_main_Dialog.showOpenDialogSync(null,options);
		if(filePaths == null) {
			return null;
		} else {
			return filePaths[0];
		}
	});
	electron_main_IpcMain.handle("saveAs",function(event,options) {
		var filePaths = electron_main_Dialog.showSaveDialogSync(null,options);
		if(filePaths == null) {
			return null;
		} else {
			return filePaths;
		}
	});
	electron_main_IpcMain.handle("exit",function(event) {
		electron_main_App.exit();
	});
	electron_main_IpcMain.handle("setFullScreen",function(event,args) {
		mainWindow.setFullScreen(args);
	});
	electron_main_IpcMain.handle("setWinTitle",function(event,args) {
		mainWindow.title = args;
	});
	var autoUpdater = require("electron-updater").autoUpdater;
	electron_main_IpcMain.handle("checkUpdate",function(event,args) {
		console.log("Checking for updates...");
		autoUpdater.checkForUpdates();
		autoUpdater.on("update-available",function(info) {
			mainWindow.webContents.send("updateFound");
		});
		autoUpdater.on("update-downloaded",function(info) {
			mainWindow.webContents.send("updateReady");
			hasDownloadedUpdate = true;
		});
	});
	electron_main_IpcMain.handle("installUpdate",function(event) {
		console.log("install");
		isInstallingUpdate = true;
		autoUpdater.quitAndInstall();
	});
	electron_main_IpcMain.on("getCwd",function(event) {
		event.returnValue = process.cwd();
	});
	electron_main_IpcMain.on("getAppDir",function(event) {
		event.returnValue = electron_main_App.getAppPath();
	});
};
var electron_main_App = require("electron").app;
var electron_main_BrowserWindow = require("electron").BrowserWindow;
var electron_main_Dialog = require("electron").dialog;
var electron_main_IpcMain = require("electron").ipcMain;
var haxe_iterators_ArrayIterator = function(array) {
	this.current = 0;
	this.array = array;
};
haxe_iterators_ArrayIterator.prototype = {
	hasNext: function() {
		return this.current < this.array.length;
	}
	,next: function() {
		return this.array[this.current++];
	}
};
ElectronMain.main();
})({});
